% !TeX encoding = windows-1251
% !TeX spellcheck = ru_RU
% !TEX root = mainrus.tex


В данном разделе мы изложим модель пользовательского интерфейса, которая учитывает все важные особенности предметной области. Для реального использования модель должна быть немного расширена, но это не предоставит сложности, так как расширения не вносят серьёзных изменений в алгоритм синтеза.

\begin{figure}[t]
	\centering
	\subfloat[Пример интерфейса GUI\label{form1}]{
		\centering
		\includegraphics[scale=0.5]{../eng/form1.png}
	}
	\vskip5mm
	\subfloat[Пример структуры GUI\label{form1-structure}]{
		\scalebox{0.5}{
			\begin{tikzpicture}
				\node[rectangle,draw] (check) at (12, 3) {\includegraphics{../eng/check.png}};
				\node[rectangle,draw] (label) at (9, 0)  {\includegraphics{../eng/label.png}};
				\node[rectangle,draw] (combo) at (15, 0) {\includegraphics{../eng/combo.png}};
				\begin{scope}
					\node[rectangle,dashed,draw,fit=(label)(combo),minimum height=2cm,minimum width=12cm] (composite) (0, 0) {};
				\end{scope}
				\path[draw,->] (label.east) -- node[above] {\emph{descr}} (combo.west);
				\path[draw,->] (check.south) -- node[right] {\emph{order}} (12,1);
	\end{tikzpicture}}}
	\vskip5mm
	\subfloat[Пример реального расположения элементов управления\label{form1-layout}]{
		\scalebox{0.5}{
			\begin{tikzpicture}
				\node (label) at (7.8, 2.5) {\emph{justify}};
				\node[rectangle,draw] (check) at (9.47, 1.6) {\includegraphics{../eng/check.png}};
				\node[rectangle,draw] (label) at (9.01, 0  ) {\includegraphics{../eng/label.png}};
				\node[rectangle,draw] (combo) at (14  , 0  ) {\includegraphics{../eng/combo.png}};
				\begin{scope}
					\node[rectangle,dashed,draw,fit=(label)(combo)] (composite) (0, 0) {};
				\end{scope}
				\path[draw,<->] (label.east) -- node[above] {\emph{inset}} (combo.west);
				\path[draw,<->] (check.south) -- node[right] {\emph{inset}} (9.47,0.65);
				\path[draw,-] (7.21,2.7) -- (7.21,0);
	\end{tikzpicture}}}
	\vskip5mm
	\subfloat[Пример правила предписания\label{gdrule}]{
		\includegraphics[scale=0.35]{../eng/jbg-09.png}
	}

	\caption{Пример пользовательского интерфейса: структура, расположение и правило предписания}
	\label{form1-structure-layout}
\end{figure}

Мы можем выделить три важных понятия, связанных с интерфейсами пользователя: \emph{структура}, \emph{расположение} (англ. layout) и набор правил проектирования интерфейсов (англ. guideline), который для краткости далее будем называть \emph{предписанием}. Структура описывает набор элементов управления и связи между ними, расположение уточняет их визуальные позиции друг к другу. Такое разделение согласуется с распространенной практикой отделения бизнес-логики от визуального представления~\cite{UI3}. Наконец, предписание отображает определенные структуры в конкретные примитивы расположения.

Продемонстрируем эти понятия на примере. Рассмотрим интерфейс с рис.~\ref{form1} и опишем структуру следующим образом.

\begin{itemize}
	\item Всего три элемента управления GUI: галочка (англ. check box), метка и поле со списком (англ. combo box).
	\item Присутствует зависимость между меткой и полем, так как первое \emph{описывает} второе; следовательно, их можно объединить в одну сущность.
	\item Существует зависимость между галочкой и только что введенной композитной сущностью, так как, по-видимому, дизайнер интерфейса полагал, что важность элементов управления убывает сверху вниз.
\end{itemize}

Мы схематично изобразили структуру на рис.~\ref{form1-structure}. Теперь мы можем рассматривать её как набор именованных \emph{отношений} между элементами управления, или даже над данными в них (строками, числами и т.п.). Наш подход разделяет все отношения на две категории: \emph{абстрактные} и \emph{конкретные}. Семантика абстрактных определяется предписанием, конкретных — нашей системой. Конкретные описывают типы элементов управления, различные их свойства (содержимое текстовых полей, размеры, и т.п.), а также позволяют объединять элементы управления в упорядоченные или неупорядоченные группы, или в \emph{виртуальные} --- элементы управления, объединяющие несколько в один целый.

Множество \emph{абстрактных} отношений включает: бинарное упорядочивание (один-за-другим), описание (один описывает другой, например, метка поле ввода или галочку), подчиненность (галочка делает активным/неактивным поле ввода). В реализации эти отношения — это просто удобные имена, используемые в структуре и предписании. Их семантика полностью определяется предписанием, а система никаким особым образом не обрабатывает эти отношения. Пользователи могут добавлять новые абстрактные отношения и определять их семантику в предписании для своих нужд.

Для конкретной структуры её расположение (англ. layout) определяется набором примитивов расположения, выравниванием и другими подобными свойствами. В примере метка и поле со списком располагаются горизонтально с некоторым отступом, галочка располагается сверху от введённого виртуального элемента для пары метка-поле с другим отступом, и всё расположение выровнено влево, что изображено на рис.~\ref{form1-layout}. В отличие от отношений, использованных при описании структуры, все примитивы расположения имеют фиксированную семантику, на которой основан процесс синтеза.

Наконец, предписание состоит из набора правил, описывающих какие примитивы расположения должны использоваться для соответствующих частей структуры и при каких условиях. На рис.~\ref{gdrule} можно увидеть пример такого правила, взятого из правил~\cite{JBG} проектирования интерфейсов компании JetBrains. Обычно, эти правила описываются неформально на примерах, в следующем разделе мы их формализуем.